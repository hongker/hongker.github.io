---
title: 数据结构与算法(17)- ListPack
date: 2023-05-05 09:42:00
tags: algorithm
---

## 定义
>Redis 的 Listpack 是一种专门用于实现底层的 list 数据结构的紧凑型二进制数据格式，通过优化内存占用和 CPU 执行效率等方面来提高列表操作的性能和吞吐量。通常情况下，Listpack 会在 Redis 的列表操作中与 Quicklist 和 Ziplist 进行混合组合使用。

Listpack 的设计主要有以下几个方面的考虑：

- 物理上受限。一次仅能访问固定大小的内存块，因此需要有效地优化内存占用。
- 高效归档。缓慢和大量访问时需要很快地进行归档和截断，因此需要有效地支持对跨越多块或长时间未被访问的元素的删除和收缩操作。
- 具有随机访问特性。允许针对需要随机访问的元素（如非常大的列表）使用块缓存、预取依赖等高级缓存算法以支持快速随机访问功能而不会影响整体性能。


Listpack 将列表中所有字符串类型的值编码成一种紧凑的、不可变的字节数组并按顺序连接起来，同时还维护了一份总长度、最后一个元素的偏移量、已使用字节数和尾部空白（tail free）区域的首地址等元数据信息。为了优化内存使用和分配，Listpack 还使用了一种连续型内存结构，其中每个块包含至多 64 个字节并允许使用支持延迟分配的技术。

```
总之，Redis 的 Listpack 是一种紧凑、高效、可扩展的二进制格式，通过设计精巧的开销管理和随机访问功能来提高 Redis 列表操作性能和灵活性。
```